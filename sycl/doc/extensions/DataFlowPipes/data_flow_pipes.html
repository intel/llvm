<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7">
<title>SYCL_INTEL_data_flow_pipes</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book">
<div id="header">
<h1>SYCL_INTEL_data_flow_pipes</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This specification is a draft.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Khronos&#174; is a registered trademark and SYCL&#8482; and SPIR&#8482; are trademarks of The Khronos Group Inc.  OpenCL&#8482; is a trademark of Apple Inc. used by permission by Khronos.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This document is better viewed when rendered as html with asciidoctor.  GitHub does not render image icons.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This document describes an extension that adds pipes to SYCL.  Pipes are first in first out primitives that can provide efficient on-device communication between elements of a design, and are particularly relevant for expression of some algorithms on data flow and spatial architectures such as FPGAs.  This specification uses the term <em>pipe</em> to be consistent with terminology from OpenCL 2.0 and later, but does not expose identical functionality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_name_strings">Name Strings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SYCL_INTEL_data_flow_pipes</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notice">Notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright (c) 2019 Intel Corporation.  All rights reserved.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status">Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working Draft</p>
</div>
<div class="paragraph">
<p>This is a preview extension specification, intended to provide early access to a feature for review and community feedback. When the feature matures, this specification may be released as a formal extension.</p>
</div>
<div class="paragraph">
<p>Because the interfaces defined by this specification are not final and are subject to change they are not intended to be used by shipping software products.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version">Version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Built On: 2019-11-13<br>
Revision: 2</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact">Contact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Michael Kinsner, Intel (michael 'dot' kinsner 'at' intel 'dot' com)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependencies">Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension is written against the SYCL 1.2.1 specification, Revision v1.2.1-5.</p>
</div>
<div class="paragraph">
<p>The use of blocking pipe reads or writes requires support for <a href="https://github.com/KhronosGroup/SPIRV-Registry/blob/master/extensions/INTEL/SPV_INTEL_blocking_pipes.asciidoc">SPV_INTEL_blocking_pipes</a> if SPIR-V is used by an implementation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data flow and spatial compute architectures often expose the concept of a first in first out (FIFO) buffer.  The FIFO construct provides links between elements of a design that are accessed through read and write or push and pop application programming interfaces (APIs), without the notion of a memory address/pointer to elements within the FIFO.  Data is written to a FIFO through an API that commits a single word or packet (of FIFO data width), and that word/packet is later returned by an API reading data from the FIFO.  FIFO constructs may include storage to buffer multiple words/packets internally (accept reads even if there is previously written data that hasn&#8217;t been read) for algorithmic reasons, but are fundamentally read/write interfaces without random access ability, and internal storage does not impact semantics of the pipe.</p>
</div>
<div class="paragraph">
<p>The usefulness of FIFO constructs is not restricted to spatial architectures like FPGAs, but this extension is framed from an FPGA perspective.  Other architectures require different execution model guarantees and in some cases additional APIs to support those execution models (e.g. OpenCL pipe reservations).  The primary objective of this extension is to enable pipes on FPGA architectures, where they are fundamental to performance of some spatial algorithm decompositions.  Focusing on FPGAs simplifies the interface and semantics for this version of the extension.</p>
</div>
<div class="paragraph">
<p>OpenCL defines <em>pipes</em>, which are FIFO constructs.  This extension uses the term pipe for consistency with Khronos specifications.</p>
</div>
<div class="paragraph">
<p>FIFOs are fundamental in spatial architectures where different kernels or subsets of a kernel are executing on different regions of an accelerator.  FIFOs provide a mechanism to pass ordered data between processing regions.  This has multiple benefits, including simplifying decomposition of a problem into smaller more independent units, decoupling processing rates and hiding burst characteristics of data, and simplifying implementation details such as frequency critical paths on some architectures.</p>
</div>
<div class="paragraph">
<p>This extension adds support for pipes to SYCL.  It does not expose the full OpenCL or SPIR-V pipe feature sets (e.g. pipe reservations and dynamic connectivity), and instead focuses on the functionality required to enable performance on spatial architectures - specifically point-to-point FIFO communication between compute units (of some definition) that may be executing concurrently.  The extension aligns much more closely with OpenCL 2.2 program pipes than with OpenCL 2.0 kernel argument-based pipes, and can effectively leverage the program pipe representation in SPIR-V.  Like the relation to OpenCL and SPIR-V, this extension also does not align with the pipes definition published in the provisional SYCL 2.2 specification, which has been deprecated and was not finalized.</p>
</div>
<div class="paragraph">
<p>This extension enables four classes of pipe connectivity:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Cross kernel:</strong> Kernel A &#8658; Kernel B</p>
</li>
<li>
<p><strong>Intra-kernel:</strong> Kernel A &#8658; Kernel A</p>
</li>
<li>
<p><strong>Host pipe:</strong> Kernel A &#8660; host program</p>
</li>
<li>
<p><strong>I/O pipe:</strong> Kernel A &#8660; I/O peripheral</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_goals">Design goals</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Simple use cases should be simple to express</p>
</li>
<li>
<p>Complex use cases should be possible to express using native C++ mechanisms.  Need first class interaction with the C++ type system and features like templating and metaprogramming</p>
</li>
<li>
<p>Guaranteed static connectivity of pipes between kernels.  Device compilers must be able to extract and implement the connectivity of pipes between kernels in the same program.  Dynamic connectivity - binding or modification of pipe read/write connections at runtime - isn&#8217;t supported by this extension</p>
</li>
<li>
<p>Leverage the existing SPIR-V representation of pipes</p>
</li>
<li>
<p>Require minimal compiler changes for functional implementation.  Use the C++ type system to guarantee static connectivity</p>
</li>
<li>
<p>Expose single handle to pipe identity - e.g. either type or object instance, but not both</p>
</li>
<li>
<p>Expose performance available from underlying layers such as OpenCL</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_pipe_properties">Key pipe properties</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>FIFO ordering:</strong> Data is only accessible (readable) in FIFO order, specifically the program order of data written to the pipe from the perspective of a single work-item.</p>
</li>
<li>
<p><strong>Capacity:</strong> To avoid deadlock with some programming patterns that use pipes, a user must be able to define or reason about a minimum capacity, in number of data words.  Capacity is the number of outstanding words that can be written to a pipe but not yet read from it.  More specifically capacity is the number of data words that can be written to the pipe, assuming that the pipe is initialized with no contained data word(s) and that no read operations from the pipe occur, without non-blocking writes returning a "failed" status (which does not affect pipe contents or state) or blocking calls blocking indefinitely.  Compilers cannot in general infer such requirements, which depend on algorithm and accelerator characteristics, as well as host program architecture and behavior.</p>
</li>
<li>
<p><strong>Implicit control information:</strong> Pipes provide implicit control information based on availability of data in a pipe, and also the ordering of data within a pipe.  Non-blocking calls return a status indicating whether the operation was successful (was capacity in the pipe to write data, or data was available to read).  Unsuccessful non-blocking pipe reads or writes do not impact the state or content of a pipe.  Blocking calls wait until there is available capacity to commit data, or until data is available to be read.  In all of these cases the pipe indirectly conveys side channel control information to the program, which can be used for flow control or many other purposes by an application.  This implicit side channel of control information is a fundamental property of many spatial architectures and protocols, and is a primary reason that pipes are important on architectures like FPGA - they map to the hardware and spatial algorithm decompositions efficiently.</p>
</li>
<li>
<p><strong>Fine grained communication:</strong> A critical property of pipes for spatial architectures is fine grained availability of data without coarse grained synchronization points, such as kernel completion events.  On-chip communication between concurrently executing kernels, for example, requires guarantees that a consumer kernel sees data written by a producer kernel, without buffering of large amounts of data or waiting for kernel completion events that may not otherwise be desired.  Instead, finer-grained data visibility guarantees allow kernels to cooperate with minimal data storage requirements within a pipe, and is required to make cooperation between concurrently executing kernels on spatial architectures efficient.  Pipes guarantee that any word (of <code>pipeT</code> type) written to a pipe will eventually be visible to read endpoints, regardless of whether additional words are written to the pipe.  There is no minimum amount of data (beyond a single word) that must be written to receive this guarantee, and there is no minimum capacity or storage requirement associated with this guarantee.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mechanism_that_identifies_a_pipe">Mechanism that identifies a pipe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The mechanism through which a pipe is uniquely identified for reading and writing is a critical property.  It significantly influences interaction with C++ language features, and complexity of implementation in compilers.</p>
</div>
<div class="paragraph">
<p>The two primary candidate mechanisms to uniquely identify a pipe in SYCL are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Object instance of a pipe type</strong>.  This is the approach taken by the OpenCL C++ kernel language and SYCL 2.2 provisional specification</p>
</li>
<li>
<p><strong>Specialization of the pipe type</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both mechanisms should not be exposed simultaneously due to interface complexity and likelihood of bugs in application code.</p>
</div>
<div class="paragraph">
<p>The ability for a device compiler to infer static connectivity within and between kernels is the primary objective of this extension.  Everything else leads to poor performance that is difficult for a user to comprehend and correct.</p>
</div>
<div class="paragraph">
<p>This extension is based on (2) above, and specifically uses type (template specializations of the <code>pipe</code> class) to identify a pipe.  Writes to or reads from the same pipe type are accesses to the same pipe.  This approach guarantees that a device compiler can infer static connectivity of pipes by leveraging the C++ type system.</p>
</div>
<div class="paragraph">
<p>A pipe type is a specialization of the pipe class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="keyword">template</span> &lt;<span class="keyword">typename</span> name,
          <span class="keyword">typename</span> dataT,
          size_t min_capacity = <span class="integer">0</span>&gt;
<span class="keyword">class</span> <span class="class">pipe</span>;</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The combined set of the three template parameters forms the type of a pipe.  Any uses of a read/write member function on that type operate on the same pipe.</p>
</div>
<div class="paragraph">
<p>A difference in any of the three template parameters identifies a different pipe.  For example, all of the pipes in the following snip are different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="directive">using</span> pipe&lt;<span class="keyword">class</span> <span class="class">foo</span>, <span class="predefined-type">int</span>&gt;;
<span class="directive">using</span> pipe&lt;<span class="keyword">class</span> <span class="class">bar</span>, <span class="predefined-type">int</span>&gt;;
<span class="directive">using</span> pipe&lt;<span class="keyword">class</span> <span class="class">bar</span>, <span class="predefined-type">float</span>&gt;;
<span class="directive">using</span> pipe&lt;<span class="keyword">class</span> <span class="class">bar</span>, <span class="predefined-type">float</span>, <span class="integer">5</span>&gt;;</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface of a pipe is through static member functions, and instances of a pipe class cannot be instantiated.  Allowing instances of pipe objects, when their type defines connectivity, would introduce an error prone secondary mechanism of reference.</p>
</div>
<div class="paragraph">
<p>The first template parameter, <code>name</code>, can be any type, and is typically expected to be a user defined class in a user namespace.  The type only needs to be forward declared, and not defined.</p>
</div>
<div class="paragraph">
<p>Above this basic mechanism of C++ type being used to identify a pipe, additional layers can be built on top to contain the type in an object that can be passed by value.  Because such mechanisms (e.g. <code>boost::hana::type</code>) can layer on top of the fundamental type-based mechanism described here, those mechanisms are not included in the extension specification.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_example_of_an_inter_kernel_pipe">Simple example of an inter-kernel pipe</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre><span class="comment">// It is highly recommended to declare the type at a scope visible to all uses.</span>
<span class="comment">// Defining a type alias (like shown here) is the recommended practice for users</span>
<span class="comment">// without reason to do otherwise.</span>
<span class="directive">using</span> my_pipe = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;;

myQueue.submit([&amp;](handler&amp; cgh) {
  <span class="directive">auto</span> read_acc = readBuf.get_access&lt;access::mode::read&gt;(cgh);

  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">foo</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="comment">// Note: The ordering of work-item IDs writing to the pipe is not defined</span>
    my_pipe::write( read_add[idx] );
  });
});

myQueue.submit([&amp;](handler&amp; cgh) {
  <span class="directive">auto</span> write_acc = writeBuf.get_access&lt;access::mode::write&gt;(cgh);

  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">bar</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="comment">// Note: The ordering of work-item IDs reading from the pipe is not defined</span>
    write_acc[idx] = my_pipe::read();
  });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_readwrite_member_functions_and_pipe_template_parameters">Read/write member functions, and pipe template parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The pipe class exposes static member functions for writing a data word to a pipe, and for reading a data word from a pipe.  A data word in this context is the data type that the pipe contains (<code>dataT</code> pipe template argument).</p>
</div>
<div class="paragraph">
<p>Blocking and non-blocking forms of the read and write members are defined, with the form chosen based on overload resolution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre><span class="keyword">template</span> &lt;<span class="keyword">typename</span> name,
          <span class="keyword">typename</span> dataT,
          size_t min_capacity = <span class="integer">0</span>&gt;
<span class="keyword">class</span> <span class="class">pipe</span> {
  <span class="comment">// Blocking</span>
  <span class="directive">static</span> dataT read();
  <span class="directive">static</span> <span class="directive">void</span> write( <span class="directive">const</span> dataT &amp;data );

  <span class="comment">// Non-blocking</span>
  <span class="directive">static</span> dataT read( <span class="predefined-type">bool</span> &amp;success_code );
  <span class="directive">static</span> <span class="directive">void</span> write( <span class="directive">const</span> dataT &amp;data, <span class="predefined-type">bool</span> &amp;success_code );
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The read and write member functions may be invoked within device code, or within a SYCL host program.  Some interfaces may not be available on all devices/implementations, but the pipe definition itself does not gate availability.  Instead, implementations should error if an unsupported pipe is used.  See section <a href="#device_queries">[device_queries]</a> for information on querying the availability of specific pipe features relative to a device.</p>
</div>
<div class="paragraph">
<p>The template parameters of the device type are defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Type that is the basis of pipe identification.  Typically a user-defined class, in a user namespace.  Forward declaration of the type is sufficient, and the type does not need to be defined.</p>
</li>
<li>
<p><code>dataT</code>: The type of data word/packet contained within a pipe.  This is the data type that is read during a successful <code>pipe::read</code> operation, or written during a successful <code>pipe::write</code> operation.  The type must be standard layout and trivially copyable.</p>
</li>
<li>
<p><code>min_capacity</code>: User defined minimum number of words in units of <code>dataT</code> that the pipe must be able to store without any being read out.  A minimum capacity is required in some algorithms to avoid deadlock, or for performance tuning.  An implementation can include more capacity than this parameter, but not less.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pipe_types_and_c_scope">Pipe types and C++ scope</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use of the C++ type alias mechanism (<code>using</code>) is highly encouraged, to avoid errors where slighly different pipe types inadvertently lead to unique pipes.  <code>using</code> should be nested within a user namespace(s) to protect from unexpected type collisions with pipe types elsewhere in the code, or within libraries (which should also nest name types within namespaces).</p>
</div>
<div class="paragraph">
<p>Normal C++ forward declaration and scoping rules apply.  For example, the following example has four pipes, each of which is written to once.  If the user intended to have four write endpoints of a <strong>single</strong> pipe, which is almost certain in this case because scoping prevents the pipes from ever being read, then the user could have defined the type through <code>using</code>, or at least have forward declared <code>class some_pipe</code> at a scope visible to all uses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
  <td class="code"><pre><span class="comment">// Write to a pipe</span>
myQueue.submit([&amp;](handler&amp; cgh) {
  <span class="directive">auto</span> read_acc = readBuf.get_access&lt;access::mode::read&gt;(cgh);

  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">foo</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;::write( read_add[idx] );
  });
});

<span class="comment">// Read from a different pipe (probably by accident)</span>
myQueue.submit([&amp;](handler&amp; cgh) {
  <span class="directive">auto</span> write_acc = writeBuf.get_access&lt;access::mode::write&gt;(cgh);

  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">bar</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    write_acc[idx] = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;:read();
  });
});

<span class="comment">// Write to yet a third pipe (probably by accident)</span>
{
  pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;::write( read_add[idx] );
}

<span class="comment">// Write to a fourth pipe (probably by accident)</span>
{
  pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;::write( read_add[idx] );
}

<span class="comment">// Forward declaring `class some_pipe` before this code block would have</span>
<span class="comment">// made all writes access the same pipe type.  It is highly encouraged to define</span>
<span class="comment">// pipe types through `using` once, at a scope visible to all uses, unless</span>
<span class="comment">// C++ scoping is intentionally being used to create unique pipe types.</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>An outstanding issue is whether the code example above (with writes to independent pipes) should lead to a warning within implementations.  Backends will typically already error if a pipe doesn&#8217;t have both read and write endpoint(s), but it&#8217;s easy to generate code examples where this condition is met and multiple pipe types still lead to unexpected behavior (to a user not accustomed to C++ scoping rules).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pipe_types_and_type_aliasing">Pipe types and type aliasing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Type aliases in C++ through the <code>using</code> mechanism do not change the type of a pipe.  For example, the two writes in the following code snip are to the same pipe, even though <em>name</em> in the second write is an alias to that used in the first write.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>  <span class="keyword">class</span> <span class="class">a_class</span>;
  <span class="directive">using</span> type_alias = a_class;
  pipe&lt;a_class, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);
  pipe&lt;type_alias, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_host_pipe_mapunmap">Host pipe map/unmap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipes expose two additional static member functions that are available within host code, and which map to the OpenCL C host pipe extension map/unmap interface.  These member functions provide higher bandwidth or otherwise more efficient communication on some platforms, by allowing block transfers of larger data sets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="keyword">template</span> &lt;<span class="keyword">typename</span> name,
          <span class="keyword">typename</span> dataT,
          size_t min_capacity = <span class="integer">0</span>&gt;
<span class="keyword">class</span> <span class="class">pipe</span> {
  <span class="keyword">template</span> &lt;pipe_property::writeable host_writeable&gt;
    <span class="directive">static</span> dataT* map(size_t requested_size, size_t &amp;mapped_size);

  <span class="directive">static</span> size_t unmap(T* mapped_ptr, size_t size_to_unmap);
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a pipe to be used for Kernel &#8660; host program communication, the pipe type must be readable and writeable because the host program will perform one of those operations, and a kernel will perform the other.  A pipe communicating between host and kernel is unidirectional, in that the host (and likewise kernel) will either read or write, but not both.  The <code>map</code> member function is therefore templated on the type of operation that the host will perform, using the <em>host_writeable</em> template parameter.</p>
</div>
<div class="paragraph">
<p>If <em>host_writeable</em> is true, then the host program writes to the pipe and the kernel also accessing the pipe must read from it.  If <em>host_writeable</em> is false, then the host program reads from the pipe, and the kernel accessing the pipe must write to it.</p>
</div>
<div class="paragraph">
<p>Mapping a pipe does not impact the <em>min_capacity</em> property of the pipe in any way, so a mapped memory region used to read from or write to the pipe from the host must not be considered as adding additional capacity to the pipe from the perspective of preventing application deadlock.</p>
</div>
<div class="paragraph">
<p>The APIs are defined as:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Function</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>template &lt;pipe_property::writeable host_writeable&gt;<br>
dataT* map(size_t requested_size, size_t &amp;mapped_size);</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Returns a <em>dataT *</em> in the host address space. The host can write data to this pointer for reading by a device pipe endpoint, if it was created with template parameter <code>host_writeable = true</code>.  Alternatively, the host can read data from this pointer if it was created with template parameter <code>host_writeable = false</code>.</p>
<p class="tableblock">The value returned in the mapped_size argument specifies the maximum number of bytes that the host can access. The value specified by <em>mapped_size</em> is less than or equal to the value of the <em>requested_size</em> argument that the caller specifies.  <em>mapped_size</em> does not impact the <em>min_capacity</em> property of the pipe.</p>
<p class="tableblock">After writing to or reading from the returned <em>dataT *</em>, the host must execute one or more <code>unmap</code> calls on the same pipe, to signal to the runtime that data is ready for transfer to the device (on a write), and that the runtime can reclaim the memory for reuse (on a read or write). If <code>map</code> is called on a pipe before <code>unmap</code> has been used to unmap all memory mapped by a previous <code>map</code> operation, the buffer returned by the second <code>map</code> call will not overlap with that returned by the first call.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>static size_t unmap(T* mapped_ptr, size_t size_to_unmap);</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Signals to the runtime that the host is no longer using <em>size_to_unmap</em> bytes of the host allocation that was returned previously from a call to <code>map</code>. In the case of a writeable host pipe, calling <code>unmap</code> allows the unmapped data to become available to the kernel. If the <em>size_to_unmap</em> value is smaller than the <em>mapped_size</em> value specified to <code>map</code>, then multiple <code>unmap</code> function calls are necessary to unmap the full capacity of the host allocation. It is legal to perform multiple <code>unmap</code> function calls to unmap successive bytes in the buffer returned by <code>map</code>, up to the <em>mapped_size</em> value defined in the <code>map</code> operation.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_pipe_endpoints">Multiple pipe endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Multiple reads and/or multiple writes to a pipe may require arbitration with some policy in an implementation.  Multiple reads or writes to the same pipe within a single kernel are in no way disallowed by this specification, but may be unintentional from a user perspective, particularly if materialized through optimizations such as loop unrolling.</p>
</div>
<div class="paragraph">
<p>Multiple reads or multiple writes to the same pipe from more than one kernel are not allowed, and the mechanism through which an implementation should reject this situation is implementation defined.  For this restriction, a single kernel is defined as a single built kernel within a single program object.  Multiple invocations/enqueues of such a single kernel do not violate the requirement that only a single kernel (or the host) may read from or write to a pipe.  Multiple launches of the kernel are still considered to be a single kernel from the perspective of this restriction.</p>
</div>
<div class="paragraph">
<p>When there are accesses to a pipe from different work-items or host threads, the order of data written to or read from the pipe is not defined.  Specifically, regarding multiple accesses to the same pipe:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Accesses to a single pipe within a single work-item of a kernel or thread of the host program:</strong> Operations on the same pipe occur in program order with respect to the work-item or host thread.  No "concurrent" accesses or reordering of accesses are observable from the perspective of the single pipe.  If there are multiple pipe access operations to the same pipe within a single kernel, they execute in program order from the perspective of a single work-item.</p>
</li>
<li>
<p><strong>Accesses to multiple pipes within a single work-item of a kernel or thread of the host program:</strong>  Different pipes are treated in the same way as non-aliased memory, in that accesses to one pipe may be reordered relative to accesses to another pipe.  There is no expectation of program ordering of pipe operations across different pipes, only for a single pipe.  If a happens-before relationship across pipes is required, synchronization mechanisms such as atomics or barriers must be used.</p>
</li>
<li>
<p><strong>Accesses to a single pipe within two work-items of the same kernel (same or different invocations of a single kernel), and/or threads of the host program:</strong> No ordering guarantees are made on the order of pipe operations across device work-items or host threads.  For example, if two work-items executing a kernel write to a pipe, there are no guarantees that the work-item with lower <em>id</em> (for any definition of <em>id</em>) executes before the pipe write from a higher <em>id</em>.  The execution order of work-items executing a kernel are not defined by SYCL, may be dynamically reordered, and may not be deterministic.  If ordering guarantees are required across work-items and/or host threads, synchronization mechanisms such as atomics or barriers must be used.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_restrictions_on_pipes_accessed_by_both_kernels_and_the_host_program">Restrictions on pipes accessed by both kernels and the host program</h3>
<div class="paragraph">
<p>A pipe can be accessed (read from or written to) from both device code and SYCL host code.  Host-accessible pipes are unidirectional from both the host and device perspectives.  A kernel cannot both read from and write to a pipe, that the host program also reads from or writes to.  Similarly, the host program cannot read from and write to the same pipe type.  A consequence of this rule is that loop-back host pipes are not possible using the same pipe - the host program cannot write to and also read from a pipe.  The compiler, linker, and/or runtime are required to emit an error if any of these conditions are violated.</p>
</div>
<div class="paragraph">
<p>A pipe accessed by the host can communicate with a kernel in exactly one program executing on one device.  If two instances of a kernel are launched to different devices, or if a kernel is compiled into more than one program object and both are enqueued, then the runtime is required to throw a synchronous <code>cl::sycl::kernel_error</code> exception.  The intent of this restriction is that accesses to a pipe on the host provide a point to point link with a kernel executing on a specific device without ambiguity, arbitration, broadcasts, or synchronization across devices.</p>
</div>
<div class="paragraph">
<p>The data lifetime rules for pipes apply also to host accessible pipes.  Specifically: data in a pipe exists within an instance of a program object on a device (programming bitstream lifetime on FPGA devices).  Invocation of a kernel from a different program object might destroy all data stored in pipes within the program object associated with the previous kernel(s) executed on the device, and also might destroy any data in pipes being accessed by the host that were communicating with kernel(s) in the program object.</p>
</div>
<div class="sect3">
<h4 id="_allowed">Allowed:</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="directive">using</span> my_pipe = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;;

myQueue.submit([&amp;](handler&amp; cgh) {
  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">bar</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="predefined-type">int</span> data = my_pipe::read();
    ...
  });
});

my_pipe::write(<span class="integer">5</span>);  <span class="comment">// OK.  Only communicates with single kernel</span></pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_illegal_host_and_multiple_kernels_connected_with_pipe">Illegal (host and multiple kernels connected with pipe):</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span class="directive">using</span> my_pipe = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;;

myQueue.submit([&amp;](handler&amp; cgh) {
  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">foo</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="predefined-type">int</span> data = my_pipe::read();
    ...
  });
});

myQueue.submit([&amp;](handler&amp; cgh) {
  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">bar</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="predefined-type">int</span> data = my_pipe::read();
    ...
  });
});

my_pipe::write(<span class="integer">5</span>);  <span class="comment">// Error.  Pipe communicates with two kernels</span></pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_illegal_host_access_combined_with_bidirectional_access_by_a_kernel">Illegal (host access combined with bidirectional access by a kernel):</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="directive">using</span> my_pipe = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;;

myQueue.submit([&amp;](handler&amp; cgh) {
  cgh.parallel_for&lt;<span class="keyword">class</span> <span class="class">foo</span>&gt;(range&lt;<span class="integer">1</span>&gt; { <span class="integer">1024</span> }, [=](id&lt;<span class="integer">1</span>&gt; idx) {
    <span class="predefined-type">int</span> data = my_pipe::read();
    my_pipe::write( data );  <span class="comment">// Error: Write as well as read from kernel, on pipe that is also accessed from host code (below)</span>
  });
});

my_pipe::write(<span class="integer">5</span>);</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_illegal_host_both_reads_and_writes_pipe">Illegal (host both reads and writes pipe):</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre><span class="directive">using</span> my_pipe = pipe&lt;<span class="keyword">class</span> <span class="class">some_pipe</span>, <span class="predefined-type">int</span>&gt;;

my_pipe::write(<span class="integer">5</span>);
<span class="predefined-type">int</span> data = my_pipe::read();  <span class="comment">// Error: Loopback pipes not allowed on host.  Pipes from host perspective must be unidirectional</span></pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io_pipes">I/O Pipes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The pipe class described above exposes both read and write static member functions.  Two additional classes are defined which can be exposed by an implementation, to provide access to hardware peripherals.  The link to a hardware peripheral is unidirectional, so the the classes that describe these links expose either read or write members, but not both.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span class="keyword">template</span> &lt;<span class="keyword">typename</span> name,
          <span class="keyword">typename</span> dataT,
          size_t min_capacity = <span class="integer">0</span>&gt;
<span class="keyword">class</span> <span class="class">kernel_readable_io_pipe</span> {
  <span class="directive">public</span>:
    <span class="directive">static</span> dataT read();  <span class="comment">// Blocking</span>
    <span class="directive">static</span> dataT read( <span class="predefined-type">bool</span> &amp;success_code );  <span class="comment">// Non-blocking</span>
};

<span class="keyword">template</span> &lt;<span class="keyword">typename</span> name,
          <span class="keyword">typename</span> dataT,
          size_t min_capacity = <span class="integer">0</span>&gt;
<span class="keyword">class</span> <span class="class">kernel_writeable_io_pipe</span> {
  <span class="directive">public</span>:
    <span class="directive">static</span> <span class="directive">void</span> write( dataT data );  <span class="comment">// Blocking</span>
    <span class="directive">static</span> <span class="directive">void</span> write( dataT data, <span class="predefined-type">bool</span> &amp;success_code );  <span class="comment">// Non-blocking</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre><span class="comment">// &quot;Built-in pipes&quot; provide interfaces with hardware peripherals</span>
<span class="comment">// These definitions are typically provided by a device vendor and</span>
<span class="comment">// made available to developers for use.</span>
<span class="keyword">namespace</span> example_platform {
  <span class="keyword">template</span> &lt;<span class="predefined-type">unsigned</span> ID&gt;
  <span class="keyword">struct</span> ethernet_pipe_id {
    <span class="directive">static</span> <span class="directive">constexpr</span> <span class="predefined-type">unsigned</span> id = ID;
  };

  <span class="directive">using</span> ethernet_read_pipe = kernel_readable_io_pipe&lt;ethernet_pipe_id&lt;<span class="integer">0</span>&gt;, <span class="predefined-type">int</span>, <span class="integer">0</span>&gt;;
  <span class="directive">using</span> ethernet_write_pipe =kernel_writeable_io_pipe&lt;ethernet_pipe_id&lt;<span class="integer">1</span>&gt;, <span class="predefined-type">int</span>, <span class="integer">0</span>&gt;;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_memory_model">Memory model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pipes in the context of this extension step outside the OpenCL and SYCL memory models in the following ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pipes are not defined to be in any address space.  Each pipe is conceptually in its own address space, that does not alias with any others.</p>
</li>
<li>
<p>Data written to a pipe must be eventually visible to the read endpoint of the pipe without an OpenCL synchronization point.  Specifically, kernel completion or other synchronization points are not required to guarantee pipe write side effect visibility on the read endpoint of the pipe.</p>
</li>
<li>
<p>There is no implicit synchronizes-with relationship between different pipes and/or with non-pipe memory in a named address space (e.g. global, local, private).  Specifically, there is no implicit global or local release of side effects through a pipe access, and observation of data or control information on one pipe does not imply any knowledge through happens-before relationship with a different pipe or with memory not associated with the pipe.</p>
</li>
<li>
<p>At a work-group barrier, there is an implicit acquire and release of side effects for any pipes operated on within the kernel, either before or after the barrier.  This occurs without an explicit pipe memory fence being applied as a barrier operand.</p>
</li>
<li>
<p>There are no guarantees on pipe operation side effect latency.  Writes to a pipe will eventually be visible to read operations on the pipe, without a synchronization point, but that visibility is not guaranteed to be by the time that the next instruction is executed by a writing work-item, for example.  There may be arbitrary latency between a write to a pipe and visibility of the data on a read endpoint of the pipe.  Likewise, there may be arbitrary latency between a read from a pipe, and visibility at a write endpoint that there is capacity available to write to (assuming that capacity was full prior to the read).</p>
</li>
<li>
<p>Data in a pipe is only guaranteed to exist within an instance of a program object on a device (programming bitstream lifetime on FPGA devices).  Invocation of a kernel from a different program object might destroy all data stored in pipes within the program object associated with the previous kernel(s) executed on the device.  Different devices using the same SYCL program object maintain independent pipe state and data.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sycl_dag_and_pipes">SYCL DAG and pipes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SYCL <code>accessor</code> mechanism exposes an object through which to access data, but also adds dependency edges (<em>requirements</em>) between nodes in the DAG.  Pipes imply no such dependency edges, regardless of whether they connect purely kernels, or also to host pipe operations.  A user should create DAG ordering constraints, using events for example, if required.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lowering_to_spir_v">Lowering to SPIR-V</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SPIR-V is a first class target through which SYCL pipes should be representable.  Pipes are already representable within SPIR-V due to OpenCL heritage, and this extension has been written so that it can be implemented on top of those existing representations.  The OpenCL 2.2 program pipe representation in SPIR-V is particularly relevant for repesentation of pipes from this extension.</p>
</div>
<div class="paragraph">
<p>If blocking pipe reads or writes are to be represented within SPIR-V, the extension <a href="https://github.com/KhronosGroup/SPIRV-Registry/blob/master/extensions/INTEL/SPV_INTEL_blocking_pipes.asciidoc">SPV_INTEL_blocking_pipes</a> is available to define the representation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_translation_unit_scope_linking_functions">Translation unit scope, linking, functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable libraries:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pipes must be usable within libraries which have source which is not visible to the compiler.  It must therefore be possible to connect a pipe to a library function, including linking at the implementation level.</p>
</li>
<li>
<p>Pipes must be passable to function calls through some mechanism.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Pipes in this extension are defined by type.  This allows a library to expose pipe types to an application, without also exposing internal implementation details of the library.  Library code can thus be compiled in a different translation unit, and only the pipe types documented or exported to an application.  Implementation-defined linking details are responsible for linking the code generated by different translation units, potentially at a SPIR-V level.</p>
</div>
<div class="paragraph">
<p>Library interfaces can also be templated to accept user-defined pipe types.  If the library implementation isn&#8217;t to be included in a header file, then the library implementation needs to provide an interface that separates the user-defined pipe types from data or pipe consumption by the library code which is in a different translation unit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interoperability_with_opencl_kernels">Interoperability with OpenCL kernels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Interoperability between the pipes described by this SYCL extension and OpenCL pipes is not a goal of this version of the extension, so is not defined.  OpenCL pipes are defined through kernel arguments, with host code to bind kernels together through pipes.  No mechanism is currently defined to bind a SYCL pipe type (instance of a pipe) to an OpenCL pipe kernel argument.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Example uses of pipes, as could exist for example within device code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
  <td class="code"><pre><span class="predefined-type">bool</span> success;

<span class="comment">// Simple pipe</span>
<span class="directive">using</span> my_pipe1 = pipe&lt;<span class="keyword">class</span> <span class="class">foo</span>, <span class="predefined-type">int</span>&gt;;
my_pipe1::write(<span class="integer">1</span>);           <span class="comment">// Blocking</span>
my_pipe1::read();             <span class="comment">// Blocking</span>
my_pipe1::write(<span class="integer">2</span>, success);  <span class="comment">// Non-blocking</span>
my_pipe1::read(success);      <span class="comment">// Non-blocking</span>

<span class="comment">// Simple pipe, explicit type</span>
pipe&lt;<span class="keyword">class</span> <span class="class">bar</span>, <span class="predefined-type">float</span>&gt;::write(<span class="float">2</span><span class="float">.0</span>);
pipe&lt;<span class="keyword">class</span> <span class="class">bar</span>, <span class="predefined-type">float</span>&gt;::read();

<span class="comment">// Changing the data type of a pipe is a different pipe, even with same first template parameter as my_pipe1</span>
<span class="directive">using</span> my_pipe2 = pipe&lt;<span class="keyword">class</span> <span class="class">foo</span>, <span class="predefined-type">float</span>&gt;;
my_pipe2::write(<span class="integer">1</span>);
my_pipe2::read();

<span class="comment">// Example of how namespaces create unique pipe types</span>
pipe&lt;myclass, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);               <span class="comment">// Mangled pipe name:  7myclass</span>
pipe&lt;nestA::myclass, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);        <span class="comment">// Mangled pipe name:  N5nestA7myclassE</span>
pipe&lt;nestA::nestB::myclass, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>); <span class="comment">// Mangled pipe name:  N5nestA5nestB7myclassE</span>

<span class="comment">// Built-in pipe - interface with hardware peripheral</span>
example_platform::ethernet_write_pipe::write(<span class="integer">10</span>);
example_platform::ethernet_read_pipe::read();

<span class="comment">// Numeric ID example.  Users can define arbitrarily complex functions and helper for</span>
<span class="comment">// managing pipe types, as desired.</span>
<span class="keyword">template</span> &lt;<span class="predefined-type">int</span> ID&gt;
<span class="keyword">struct</span> numeric_id {
  <span class="directive">static</span> <span class="directive">constexpr</span> <span class="predefined-type">unsigned</span> id = ID;
};
pipe&lt;numeric_id&lt;<span class="integer">0</span>&gt;, <span class="predefined-type">float</span>&gt;::write(<span class="float">3</span><span class="float">.0</span>);

<span class="comment">// Forward declaring type allows structures with enclosing scope, such as lambdas, to access the same pipe</span>
<span class="keyword">class</span> <span class="class">pipe_type_for_lambdas</span>;  <span class="comment">// Forward decl leads to types within lambdas being the same</span>
[](){
  pipe&lt;<span class="keyword">class</span> <span class="class">pipe_type_for_lambdas</span>, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);
}();
[](){
  pipe&lt;<span class="keyword">class</span> <span class="class">pipe_type_for_lambdas</span>, <span class="predefined-type">int</span>&gt;::write(<span class="integer">0</span>);
}();

<span class="comment">// Library example 1: Lib style where lib has defined a pipe type, visible through the lib header</span>
mylib_namespace::lib_fft_write_pipe::write(<span class="integer">2</span>);

<span class="comment">// Library example 2: Lib style where the pipe name is defined by library, but not dataType, for example</span>
pipe&lt;mylib_namespace::some_lib_pipe_identifier&lt;<span class="integer">3</span>&gt;, <span class="predefined-type">float</span>&gt;::write(<span class="integer">2</span>);

<span class="comment">// Library example 3: Lib style where user binds their own pipes to lib function</span>
mylib_namespace::lib_function&lt;my_pipe1, my_pipe2&gt;();</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_device_queries"><a id="device_queries"></a>Device queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add additional device information queries to Table 4.20:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Device descriptors</th>
<th class="tableblock halign-center valign-top">Return type</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">intel::info::device::kernel_kernel_pipe_support</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Returns true if the device supports pipes connecting a kernel to another or the same kernel.  Returns false otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">intel::info::device::kernel_host_pipe_support</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Returns true if the device supports pipes connecting a kernel to or from a pipe endpoint in the host program.  Returns false otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">intel::info::device::max_host_read_pipes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>size_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Maximum number of host accessible read pipes (read from the host perspective) that are supported by the device.  Returns 0 if <em>intel::info::device::kernel_host_pipe_support</em> is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">intel::info::device::max_host_write_pipes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>size_t</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Maximum number of host accessible write pipes (write from the host perspective) that are supported by the device.  Returns 0 if <em>intel::info::device::kernel_host_pipe_support</em> is false.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_function_calls_and_pitfall_to_avoid"><a id="InlinedCallGotcha"></a>Function calls and pitfall to avoid</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many advantages to pipes being defined through their type instead of instance, and library abstractions can be built on top to provide an instance-based or other interface.  The type-based interface leads to a pattern worth calling out that is well defined by the type system, but that potentially causes unexpected behavior for some users.  This is illustrated through a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre><span class="directive">void</span> pipe_memcpy(<span class="predefined-type">int</span>* dest, <span class="directive">const</span> <span class="predefined-type">int</span>* src, size_t n) {
  <span class="directive">constexpr</span> <span class="predefined-type">int</span> N = <span class="integer">10</span>;  <span class="comment">// n &lt;= N.  No checking here for simplicity</span>
  <span class="directive">using</span> mypipe = pipe&lt;<span class="keyword">class</span> <span class="class">local</span>, <span class="predefined-type">int</span>, N&gt;;
  <span class="keyword">for</span> (size_t i = <span class="integer">0</span>; i &lt; n; ++i) mypipe::write(src[i]);
  <span class="keyword">for</span> (size_t i = <span class="integer">0</span>; i &lt; n; ++i) dest[i] = mypipe::read();
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For serialized calls to pipe_memcpy, within a kernel for example, all behaves as expected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>pipe_memcpy(d1, s1, N);
pipe_memcpy(d2, s2, N);</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same pipe type is reused by both of these calls, but the calls execute serially so the memcpy behavior is as expected.</p>
</div>
<div class="paragraph">
<p>Once concurrency enters the picture, then <code>pipe_memcpy</code> potentially exhibits unexpected behavior because the pipe type declared locally to the function is identical/common across the calls.  This can be exposed through calls from different kernels that happen to be executing concurrently, or by calls from different work-items in the same kernel.  The pipe therefore becomes a resource that is identical/common across calls to <code>pipe_memcpy</code>, and requires either uniquification between invocations, or handling similar to concurrent accesses to a shared memory resource.  This is the expected and desired behavior, but if users intend for the pipe to be privatized per invocation, then they must explicitly code for that.</p>
</div>
<div class="paragraph">
<p>Note that calls from the same kernel and same work-item which happen to be inlined and otherwise optimized to execute "concurrently" will not exhibit incorrect behavior - sequential consistency within a work-item is still required.  The pipe accesses have side effects, and each pipe is conceptually in it&#8217;s own address space that doesn&#8217;t alias with any others.  Within a single work-item, the compiler is not free to arbitrarily reorder operations with side effects.</p>
</div>
<div class="paragraph">
<p>Uses of pipes declared within a function call that is invoked in a concurrent way are not common, but are legal.</p>
</div>
<div class="paragraph">
<p>Users can privatize the pipe type by templating the function, if they do require independent pipes for concurrent calls to the function.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre><span class="keyword">template</span> &lt;<span class="predefined-type">int</span> id&gt;
<span class="directive">void</span> pipe_memcpy(<span class="predefined-type">int</span>* dest, <span class="directive">const</span> <span class="predefined-type">int</span>* src, size_t n) {
  <span class="directive">constexpr</span> <span class="predefined-type">int</span> N = <span class="integer">10</span>;  <span class="comment">// n &lt;= N.  No checking here for simplicity</span>
  <span class="directive">using</span> mypipe = pipe&lt;<span class="keyword">class</span> <span class="class">local</span>, <span class="predefined-type">int</span>, N&gt;;
  <span class="keyword">for</span> (size_t i = <span class="integer">0</span>; i &lt; n; ++i) mypipe::write(src[i]);
  <span class="keyword">for</span> (size_t i = <span class="integer">0</span>; i &lt; n; ++i) dest[i] = mypipe::read();
}

...

pipe_memcpy&lt;<span class="integer">1</span>&gt;(d1, s1, N);
pipe_memcpy&lt;<span class="integer">2</span>&gt;(d2, s2, N);</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example function <code>pipe_memcpy()</code> could alternatively be templated on the pipe type (first template argument of the pipe class specialization), amongst other possibilities.</p>
</div>
<div class="paragraph">
<p>Automated mechanisms are possible to provide uniquification across calls, and could be exposed through a wrapper or library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_required_warning_messages_needing_compiler_support"><a id="warnings"></a>Required warning messages needing compiler support</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Warning if two pipes are found within the translation unit that have an identical first template argument, and differ only in one or more of the following template arguments.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues">Issues</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Should a warning be required if there is no forward declaration of a pipe type (e.g. declared within an expression)?  More specifically, should we add a required compiler warning/error if a pipe name type (first template argument of pipe type) is declared at a scope local to the pipe type declaration?  This would result in feedback to the user if they didn&#8217;t declare the type at some scope larger than the pipe declaration, which is possibly a bug that will result in misconnected or unconnected pipes.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>RESOLUTION</strong>: Not resolved.  Looking for input, because this is a valid design pattern in some cases.</p>
</div>
</div>
</div>
</li>
<li>
<p>Arbitration is allowed by default (more than one read or write endpoint) within a single kernel.  Should there be an additional pipe template parameter to disable arbitration, as part of the type?  Downsides are that restriction as part of the type requires compiler support, since the pipe and read/write member functions are stateless, and adding additional parameters to the type increases likelihood of accidentally creating two pipes with slightly different parameterizations.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>RESOLUTION</strong>: Resolved.  Not adding template parameter in this version because want to minimize parameters of the type.  But open to further input.</p>
</div>
</div>
</div>
</li>
<li>
<p>Pipe types effectively link globally, if the name type is at a global scope.  There is no way to scope a type to only apply in a restricted region of code aside from a namespace scope, with the same type elsewhere forming a different pipe.  Namespaces can make this very manageable, but adding as an issue to make sure that this is well understood.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>RESOLUTION</strong>: Resolved.  Need good documentation on this, but is a fundamental property of the type-based approach.</p>
</div>
</div>
</div>
</li>
<li>
<p>Can&#8217;t pass pipe as argument without additional wrapping.  Again, this is a feature in many ways, but important to make explicit.  Without a mechanism to contain a type as an object, pipes are passed as template arguments.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>RESOLUTION</strong>: Resolved.  This is the design.  Wrapper libs can be built to enable pass-by-value appearance.</p>
</div>
</div>
</div>
</li>
<li>
<p>Arrays of pipes are not supported without additional wrapping of the type into a container built for the purpose.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>RESOLUTION</strong>: Resolved.  Abstraction/libraries on top enable functionality like this.  We will make public a library that enables arrays of pipes.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history">Revision History</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rev</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-09-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Michael Kinsner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Initial public working draft</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-11-13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Michael Kinsner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incorporate feedback</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-11-13 20:55:49 EST
</div>
</div>
</body>
</html>