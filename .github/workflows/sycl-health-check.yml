name: Check load of the machine 

#workflow_call
on:
  push:
    branches:
      - luszczewskakasia1_monitoring
#zmieniÄ‡ date na dzisaj
jobs:
  health-check:
    runs-on: ["self-hosted"]
    steps:
      - name: Check load average
        id: check
        run: |
          DATE=$(date -d 'yesterday' +"%Y-%m-%d")
          echo "DATE=${DATE}" >> $GITHUB_OUTPUT
          echo ${{ runner.name }} >> ${DATE}_${{ runner.name }}.txt
          uptime | awk -F'load average:' '{ print $2 }' >> ${DATE}_${{ runner.name }}.txt
      - name: Upload load average artifact
        uses: actions/upload-artifact@v5
        with:
          name: ${{ steps.check.outputs.DATE }}_${{ runner.name }}_load-average
          path: ${{ steps.check.outputs.DATE }}_${{ runner.name }}.txt
  
  call-aggregate:
    needs: health-check
    uses: ./.github/workflows/sycl-aggregate-data.yml
  

