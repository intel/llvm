name: SYCL Windows Test

on:
  workflow_call:
    inputs:
      build_cache_suffix:
        type: string
        required: false
        default: "default"
      build_ref:
        type: string
        required: false
      changes:
        type: string
        description: 'Filter matches for the changed files in the PR'
        default: '[llvm, clang, sycl, llvm_spirv, xptifw, libclc, libdevice]'
        required: false
      artifact_archive_name:
        type: string
        default: llvm_sycl.tar.gz
      retention-days:
        description: 'Artifacts retention period'
        type: string
        default: 3

jobs:
  build:
    uses: ./.github/workflows/sycl_windows_build.yml
    with:
      build_cache_suffix: ${{ inputs.build_cache_suffix }}
      build_ref: ${{ inputs.build_ref }}
      changes: ${{ inputs.changes }}
      artifact_archive_name: ${{ inputs.artifact_archive_name }}
      retention-days: ${{ inputs.retention-days }}

  e2e-win:
    needs: build
    # Continue if build was successful.
    if: ${{ always() && needs.build.outputs.build_conclusion == 'success' }}
    uses: ./.github/workflows/sycl_windows_run_tests.yml
    with:
      name: Intel GEN12 Graphics with Level Zero
      runner: '["Windows","gen12"]'
      extra_lit_opts:
      ref: ${{ inputs.build_ref }}
      sycl_toolchain_artifact: 'sycl_windows_default'
      sycl_toolchain_archive: ${{ inputs.artifact_archive_name }}
