; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-globals all --version 5
; RUN: opt < %s -passes=deadargelim -S | FileCheck %s

define internal void @test1(i32 %v, ptr byval(i32) %DEADARG1, ptr %p) {
; CHECK-LABEL: define internal void @test1(
; CHECK-SAME: i32 [[V:%.*]], ptr [[P:%.*]]) {
; CHECK-NEXT:    store i32 [[V]], ptr [[P]], align 4
; CHECK-NEXT:    ret void
;
  store i32 %v, ptr %p
  ret void
}

define internal void @test2(ptr byval(i32) %DEADARG1, ptr byval(i32) %p) {
; CHECK-LABEL: define internal void @test2(
; CHECK-SAME: ptr byval(i32) [[P:%.*]]) {
; CHECK-NEXT:    store i32 0, ptr [[P]], align 4
; CHECK-NEXT:    ret void
;
  store i32 0, ptr %p
  ret void
}

define internal void @test3(ptr byval(i32) %DEADARG1, i32 %v, ptr byval(i32) %p) {
; CHECK-LABEL: define internal void @test3(
; CHECK-SAME: i32 [[V:%.*]], ptr byval(i32) [[P:%.*]]) {
; CHECK-NEXT:    store i32 [[V]], ptr [[P]], align 4
; CHECK-NEXT:    ret void
;
  store i32 %v, ptr %p
  ret void
}

define internal void @test4(ptr byval(i32) %p, i32 %v, ptr byval(i32) %DEADARG) {
; CHECK-LABEL: define internal void @test4(
; CHECK-SAME: ptr byval(i32) [[P:%.*]], i32 [[V:%.*]]) {
; CHECK-NEXT:    store i32 [[V]], ptr [[P]], align 4
; CHECK-NEXT:    ret void
;
  store i32 %v, ptr %p
  ret void
}

define internal void @test5(ptr byval(i32) %p, i32 %x, ptr byval(i32) %DEADARG1, ptr byval(i32) %DEADARG2, i32 %y, ptr byval(i32) %q) {
; CHECK-LABEL: define internal void @test5(
; CHECK-SAME: ptr byval(i32) [[P:%.*]], i32 [[X:%.*]], i32 [[Y:%.*]], ptr byval(i32) [[Q:%.*]]) {
; CHECK-NEXT:    [[T:%.*]] = add i32 [[X]], [[Y]]
; CHECK-NEXT:    store i32 [[T]], ptr [[P]], align 4
; CHECK-NEXT:    store i32 [[T]], ptr [[Q]], align 4
; CHECK-NEXT:    ret void
;
  %t = add i32 %x, %y
  store i32 %t, ptr %p
  store i32 %t, ptr %q
  ret void
}

!nvvm.annotations = !{
  !0, !1,
  !3, !4, !6,
  !8, !9, !11,
  !13, !14, !16,
  !18, !19
}

; Note - also test various permutations of the parameter lists, as they are not
; specified to be in any particular order (e.g., consecutive).
!0 = !{ptr @test1, !"kernel", i32 1}
!1 = !{ptr @test1, !"grid_constant", !2}
!2 = !{i32 2}

!3 = !{ptr @test2, !"kernel", i32 1}
!4 = !{ptr @test2, !"grid_constant", !5}
!5 = !{i32 1, i32 2}
!6 = !{ptr @test2, !"grid_constant", !7}
!7 = !{i32 2, i32 1}

!8 = !{ptr @test3, !"kernel", i32 1}
!9 = !{ptr @test3, !"grid_constant", !10}
!10 = !{i32 1, i32 3}
!11 = !{ptr @test3, !"grid_constant", !12}
!12 = !{i32 3, i32 1}

!13 = !{ptr @test4, !"kernel", i32 1}
!14 = !{ptr @test4, !"grid_constant", !15}
!15 = !{i32 1, i32 3}
!16 = !{ptr @test4, !"grid_constant", !17}
!17 = !{i32 3, i32 1}

!18 = !{ptr @test5, !"kernel", i32 1}
!19 = !{ptr @test5, !"grid_constant", !20, !"grid_constant", !21, !"grid_constant", !22}
!20 = !{i32 1, i32 3, i32 4, i32 6}
!21 = !{i32 3, i32 1, i32 4, i32 6}
!22 = !{i32 3, i32 1, i32 6, i32 4}
;.
; CHECK: [[META0:![0-9]+]] = !{ptr @test1, !"kernel", i32 1}
; CHECK: [[META1:![0-9]+]] = !{ptr @test1, !"grid_constant", [[META2:![0-9]+]]}
; CHECK: [[META2]] = !{}
; CHECK: [[META3:![0-9]+]] = !{ptr @test2, !"kernel", i32 1}
; CHECK: [[META4:![0-9]+]] = !{ptr @test2, !"grid_constant", [[META5:![0-9]+]]}
; CHECK: [[META5]] = !{i32 1}
; CHECK: [[META6:![0-9]+]] = distinct !{ptr @test2, !"grid_constant", [[META5]]}
; CHECK: [[META7:![0-9]+]] = !{ptr @test3, !"kernel", i32 1}
; CHECK: [[META8:![0-9]+]] = !{ptr @test3, !"grid_constant", [[META9:![0-9]+]]}
; CHECK: [[META9]] = !{i32 2}
; CHECK: [[META10:![0-9]+]] = distinct !{ptr @test3, !"grid_constant", [[META9]]}
; CHECK: [[META11:![0-9]+]] = !{ptr @test4, !"kernel", i32 1}
; CHECK: [[META12:![0-9]+]] = !{ptr @test4, !"grid_constant", [[META5]]}
; CHECK: [[META13:![0-9]+]] = distinct !{ptr @test4, !"grid_constant", [[META5]]}
; CHECK: [[META14:![0-9]+]] = !{ptr @test5, !"kernel", i32 1}
; CHECK: [[META15:![0-9]+]] = !{ptr @test5, !"grid_constant", [[META16:![0-9]+]], !"grid_constant", [[META16]], !"grid_constant", [[META16]]}
; CHECK: [[META16]] = !{i32 1, i32 4}
;.
